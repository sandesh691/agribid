(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6426],{2639:(e,t,s)=>{Promise.resolve().then(s.bind(s,245))},6046:(e,t,s)=>{"use strict";var r=s(6658);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},245:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(5155),i=s(2115),a=s(6046),n=s(3839),l=s(7149);function c(){let{id:e}=(0,a.useParams)(),{showToast:t}=(0,n.d)(),{showModal:s}=(0,l.h)(),[c,d]=(0,i.useState)(null),[o,u]=(0,i.useState)(!0),[m,h]=(0,i.useState)(!1);(0,a.useRouter)(),(0,i.useEffect)(()=>{y()},[e]);let y=async()=>{try{let t=await fetch("/api/crops/details?id=".concat(e)),s=await t.json();d(s)}catch(e){console.error(e)}finally{u(!1)}},p=async e=>{s({title:"Accept this bid?",message:"Once accepted, this bid will be finalized and a transaction record will be created. This action cannot be undone.",type:"confirm",confirmText:"Yes, Accept Bid",cancelText:"No, Go Back",onConfirm:async()=>{h(!0);try{let s=await fetch("/api/bids/".concat(e,"/accept"),{method:"POST"}),r=await s.json();s.ok?(t("Bid accepted successfully!","success"),y()):t(r.error||"Failed to accept bid","error")}catch(e){t("An error occurred","error")}finally{h(!1)}}})};return o?(0,r.jsx)("div",{children:"Loading crop bids..."}):c?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"card",style:{marginBottom:"2rem"},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{style:{marginBottom:"0.5rem"},children:c.name}),(0,r.jsxs)("div",{style:{display:"flex",gap:"1rem",color:"var(--text-muted)"},children:[(0,r.jsxs)("span",{children:["Listed: ",new Date(c.biddingStartTime).toLocaleDateString()]}),(0,r.jsxs)("span",{children:["Available: ",(0,r.jsxs)("strong",{children:[c.availableQuantity," / ",c.totalQuantity," kg"]})]}),(0,r.jsxs)("span",{children:["Status: ",(0,r.jsx)("strong",{style:{color:"ACTIVE"===c.status?"var(--primary-green)":"red"},children:c.status})]})]})]}),(0,r.jsxs)("div",{style:{textAlign:"right"},children:[(0,r.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--text-muted)"},children:"Min Price"}),(0,r.jsxs)("div",{style:{fontSize:"1.25rem",fontWeight:"bold"},children:["₹",c.minPrice,"/kg"]})]})]})}),(0,r.jsxs)("h3",{style:{marginBottom:"1rem"},children:["Active Bids (",c.bids.length,")"]}),0===c.bids.length?(0,r.jsx)("div",{className:"card",style:{textAlign:"center",padding:"3rem"},children:(0,r.jsx)("p",{children:"No bids received yet."})}):(0,r.jsx)("div",{style:{display:"grid",gap:"1rem"},children:c.bids.map(e=>{var t,s;return(0,r.jsxs)("div",{className:"card",style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderLeft:"ACCEPTED"===e.status?"4px solid var(--primary-green)":"none"},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"0.25rem"},children:[(0,r.jsxs)("span",{style:{fontSize:"1.1rem",fontWeight:"bold"},children:["₹",e.pricePerKg,"/kg"]}),(0,r.jsxs)("span",{className:"badge badge-active",children:[e.quantity," kg"]}),(0,r.jsxs)("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:["Total: ₹",e.pricePerKg*e.quantity]})]}),(0,r.jsxs)("div",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:["Bidder: ",(0,r.jsx)("strong",{children:(null===(s=e.retailer)||void 0===s?void 0:null===(t=s.retailerProfile)||void 0===t?void 0:t.businessName)||"Unknown"})," • Trust Score: ",(0,r.jsxs)("strong",{style:{color:"var(--primary-green)"},children:[e.retailer.trustScore,"%"]})," • ",new Date(e.timestamp).toLocaleString()]}),"ACCEPTED"===e.status&&(0,r.jsx)("div",{style:{color:"var(--primary-green)",fontWeight:"bold",marginTop:"0.5rem"},children:"✅ ACCEPTED"})]}),"PENDING"===e.status&&"ACTIVE"===c.status&&(0,r.jsx)("button",{onClick:()=>p(e.id),className:"btn-primary",disabled:m||c.availableQuantity<e.quantity,children:"Accept Bid"})]},e.id)})})]}):(0,r.jsx)("div",{children:"Crop not found."})}}},e=>{var t=t=>e(e.s=t);e.O(0,[5099,7899,8441,1517,7358],()=>t(2639)),_N_E=e.O()}]);