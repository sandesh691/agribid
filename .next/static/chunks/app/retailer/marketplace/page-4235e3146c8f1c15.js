(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4639],{8557:(e,t,r)=>{Promise.resolve().then(r.bind(r,8997))},6967:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let i=(0,r(7401).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},1594:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let i=(0,r(7401).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},3239:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let i=(0,r(7401).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6889:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let i=(0,r(7401).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},5525:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let i=(0,r(7401).A)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]])},8617:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let i=(0,r(7401).A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},853:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let i=(0,r(7401).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},767:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let i=(0,r(7401).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},8997:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var i=r(5155),a=r(2115),s=r(380),n=r(3839),o=r(6967),l=r(853),d=r(5525);let c=(0,r(7401).A)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);var m=r(6889),f=r(8173),p=r.n(f);function x(){let{language:e,t}=(0,s.o)(),{showToast:r}=(0,n.d)(),[f,x]=(0,a.useState)([]),[h,y]=(0,a.useState)(!0),[u,b]=(0,a.useState)(""),[j,v]=(0,a.useState)({grade:"",type:"",minTrust:0}),[k,w]=(0,a.useState)(0);(0,a.useEffect)(()=>{w(Date.now());let e=setInterval(()=>w(Date.now()),1e4);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{_()},[u,j]);let _=async()=>{y(!0);try{let e=new URLSearchParams({name:u,grade:j.grade,type:j.type}),t=await fetch("/api/crops?".concat(e)),r=await t.json();x(r)}catch(e){console.error(e)}finally{setTimeout(()=>y(!1),500)}};return(0,i.jsxs)("div",{style:{paddingBottom:"3rem"},children:[(0,i.jsxs)("div",{style:{marginBottom:"2.5rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"var(--text-muted)",fontSize:"0.85rem",marginBottom:"1rem"},children:[(0,i.jsx)(p(),{href:"/retailer",style:{color:"inherit",textDecoration:"none"},children:t("sidebar_dashboard")}),(0,i.jsx)(o.A,{size:14}),(0,i.jsx)("span",{style:{color:"var(--primary-green)",fontWeight:"bold"},children:t("marketplace_title")})]}),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap",gap:"1rem"},children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{style:{fontSize:"2.5rem",fontWeight:"800",color:"var(--primary-green)",marginBottom:"0.5rem"},children:t("marketplace_title")}),(0,i.jsx)("p",{style:{color:"var(--text-muted)",fontSize:"1.1rem"},children:t("retailer_desc")})]})})]}),(0,i.jsx)("div",{className:"card",style:{marginBottom:"2.5rem",padding:"1.5rem",background:"white",borderRadius:"20px",boxShadow:"0 10px 30px rgba(0,0,0,0.03)"},children:(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap",alignItems:"center"},children:[(0,i.jsxs)("div",{style:{flex:1,minWidth:"300px",position:"relative"},children:[(0,i.jsx)(l.A,{size:20,style:{position:"absolute",left:"1rem",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),(0,i.jsx)("input",{type:"text",placeholder:t("search_crop_hint"),value:u,onChange:e=>b(e.target.value),style:{width:"100%",padding:"1rem 1rem 1rem 3rem",borderRadius:"12px",border:"2px solid #f1f5f9",background:"#f8fafc",transition:"all 0.3s"}})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:[(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsxs)("select",{value:j.grade,onChange:e=>v({...j,grade:e.target.value}),style:{padding:"0.85rem 2.5rem 0.85rem 1rem",borderRadius:"12px",border:"2px solid #f1f5f9",background:"#f8fafc",appearance:"none",fontWeight:"500"},children:[(0,i.jsx)("option",{value:"",children:t("all_grades")}),(0,i.jsx)("option",{value:"A",children:t("grade_a")}),(0,i.jsx)("option",{value:"B",children:t("grade_b")}),(0,i.jsx)("option",{value:"C",children:t("grade_c")})]}),(0,i.jsx)(o.A,{size:16,style:{position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%) rotate(90deg)",pointerEvents:"none",color:"#64748b"}})]}),(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsxs)("select",{value:j.type,onChange:e=>v({...j,type:e.target.value}),style:{padding:"0.85rem 2.5rem 0.85rem 1rem",borderRadius:"12px",border:"2px solid #f1f5f9",background:"#f8fafc",appearance:"none",fontWeight:"500"},children:[(0,i.jsx)("option",{value:"",children:t("all_bid_types")}),(0,i.jsx)("option",{value:"BULK",children:t("bulk_bids")}),(0,i.jsx)("option",{value:"MINI",children:t("mini_bids")})]}),(0,i.jsx)(o.A,{size:16,style:{position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%) rotate(90deg)",pointerEvents:"none",color:"#64748b"}})]}),(0,i.jsxs)("button",{onClick:_,className:"btn-primary",style:{padding:"0 2rem",borderRadius:"12px",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsx)(d.A,{size:18})," ",t("apply_btn")]})]})]})}),h?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"5rem 0"},children:[(0,i.jsx)("div",{className:"animate-spin",style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid var(--primary-green)",borderRadius:"50%",margin:"0 auto 1.5rem auto"}}),(0,i.jsx)("p",{style:{color:"var(--text-muted)",fontWeight:"500"},children:t("loading_marketplace")})]}):0===f.filter(e=>new Date(e.biddingEndTime).getTime()>k).length?(0,i.jsxs)("div",{className:"card animate-fade",style:{textAlign:"center",padding:"5rem 2rem",background:"white",borderRadius:"24px"},children:[(0,i.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1.5rem"},children:"\uD83C\uDF3E"}),(0,i.jsx)("h2",{style:{marginBottom:"1rem"},children:t("no_matching_crops")}),(0,i.jsx)("p",{style:{color:"var(--text-muted)"},children:t("adjust_filters")})]}):(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(340px, 1fr))",gap:"2rem"},children:f.filter(e=>new Date(e.biddingEndTime).getTime()>k).map(a=>{var s,n;let o=!(new Date(a.biddingStartTime).getTime()<=k);return(0,i.jsxs)("div",{className:"card stat-card-hover animate-fade",style:{display:"flex",flexDirection:"column",opacity:o?.9:1,padding:"1.5rem",borderRadius:"24px",border:"none",background:"white"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1.25rem",alignItems:"center"},children:[(0,i.jsxs)("span",{style:{padding:"0.4rem 0.8rem",borderRadius:"100px",fontSize:"0.75rem",fontWeight:"800",background:"BULK"===a.biddingType?"#eff6ff":"#f0fdf4",color:"BULK"===a.biddingType?"#1e40af":"#166534",display:"flex",alignItems:"center",gap:"0.4rem"},children:[(0,i.jsx)(c,{size:14})," ",a.biddingType]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.4rem",color:o?"#f59e0b":"#ef4444",fontSize:"0.85rem",fontWeight:"700"},children:[(0,i.jsx)(m.A,{size:16}),(0,i.jsxs)("span",{children:[o?t("starts_in"):t("ends_in_label"),": ",function(e,t){let r=new Date(e).getTime()-Date.now();if(r<=0)return"0h 0m";let i=Math.floor(r/36e5),a=Math.floor(r%36e5/6e4);return"hi"===t?"".concat(i,"घं ").concat(a,"मि"):"kn"===t?"".concat(i,"ಗಂ ").concat(a,"ನಿ"):"".concat(i,"h ").concat(a,"m")}(o?a.biddingStartTime:a.biddingEndTime,e)]})]})]}),(0,i.jsx)("h2",{style:{fontSize:"1.5rem",marginBottom:"1rem",color:"#1e293b"},children:a.name}),(0,i.jsxs)("div",{style:{display:"flex",gap:"1.5rem",marginBottom:"1.5rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,i.jsx)("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:t("quality_grade_label")}),(0,i.jsx)("span",{style:{fontWeight:"800",color:"var(--primary-green)",fontSize:"1.1rem"},children:a.qualityGrade})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,i.jsx)("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)"},children:t("total_quantity_label")}),(0,i.jsxs)("span",{style:{fontWeight:"800",color:"#1e293b",fontSize:"1.1rem"},children:[a.availableQuantity," kg"]})]})]}),(0,i.jsxs)("div",{style:{background:"#f8fafc",padding:"1.25rem",borderRadius:"16px",marginBottom:"1.5rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.75rem"},children:[(0,i.jsxs)("span",{style:{fontSize:"0.9rem",color:"#64748b"},children:[t("min_price_label_short"),":"]}),(0,i.jsxs)("span",{style:{fontWeight:"bold"},children:["₹",a.minPrice,"/kg"]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:"var(--primary-green)"},children:[(0,i.jsxs)("span",{style:{fontSize:"0.9rem",fontWeight:"700"},children:[t("current_highest"),":"]}),(0,i.jsxs)("span",{style:{fontWeight:"900",fontSize:"1.25rem"},children:["₹",(null===(n=a.bids)||void 0===n?void 0:null===(s=n[0])||void 0===s?void 0:s.pricePerKg)||a.minPrice,"/kg"]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"1.5rem",padding:"1rem",background:"#f0fdf4",borderRadius:"12px",border:"1px solid #dcfce7"},children:[(0,i.jsx)("div",{style:{width:"40px",height:"40px",background:"white",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 6px rgba(0,0,0,0.05)"},children:"\uD83D\uDC68‍\uD83C\uDF3E"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:"0.8rem",fontWeight:"700",color:"#166534"},children:t("farmer_trust_score")}),(0,i.jsxs)("div",{style:{color:"var(--primary-green)",fontSize:"0.9rem",fontWeight:"800"},children:[a.farmer.user.trustScore,"% ",t("verified_label")]})]})]}),(0,i.jsx)("div",{style:{marginTop:"auto"},children:o?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"1.25rem",background:"#f1f5f9",borderRadius:"14px",color:"#475569",fontSize:"1rem",fontWeight:"700",border:"1px dashed #cbd5e1",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[(0,i.jsx)(m.A,{size:20})," ",t("bidding_starts_at")," ",new Date(a.biddingStartTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}):(0,i.jsx)(g,{crop:a,onBidSuccess:_,t:t,showToast:r})})]},a.id)})})]})}function g(e){let{crop:t,onBidSuccess:r,t:s,showToast:n}=e,[o,l]=(0,a.useState)("BULK"===t.biddingType?t.availableQuantity:1),[d,c]=(0,a.useState)(t.minPrice+1),[m,f]=(0,a.useState)(!1),p=async()=>{f(!0);try{let e=await fetch("/api/bids",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cropId:t.id,quantity:Number(o),pricePerKg:Number(d)})}),i=await e.json();e.ok?(n(s("bid_success"),"success"),r()):n(i.error||"Failed","error")}catch(e){console.error(e),n("An error occurred","error")}finally{f(!1)}};return(0,i.jsxs)("div",{style:{marginTop:"auto"},children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem",marginBottom:"1rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.4rem"},children:[(0,i.jsx)("label",{style:{fontSize:"0.8rem",fontWeight:"800",color:"#64748b",paddingLeft:"0.25rem"},children:s("qty_kg")}),(0,i.jsx)("input",{type:"number",value:o,onChange:e=>l(Number(e.target.value)),disabled:"BULK"===t.biddingType,style:{width:"100%",padding:"0.85rem",borderRadius:"12px",border:"2px solid #f1f5f9",background:"BULK"===t.biddingType?"#f1f5f9":"white",fontWeight:"800"}})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.4rem"},children:[(0,i.jsx)("label",{style:{fontSize:"0.8rem",fontWeight:"800",color:"#64748b",paddingLeft:"0.25rem"},children:s("price_per_kg")}),(0,i.jsx)("input",{type:"number",value:d,onChange:e=>c(Number(e.target.value)),style:{width:"100%",padding:"0.85rem",borderRadius:"12px",border:"2px solid #f1f5f9",fontWeight:"800"}})]})]}),(0,i.jsx)("button",{onClick:p,className:"btn-primary",style:{width:"100%",padding:"1rem",borderRadius:"14px",fontSize:"1rem",fontWeight:"800",boxShadow:"0 4px 12px rgba(34, 197, 94, 0.2)"},disabled:m,children:m?s("placing_bid"):s("place_bid_btn")})]})}},3839:(e,t,r)=>{"use strict";r.d(t,{ToastProvider:()=>f,d:()=>x});var i=r(5155),a=r(8803),s=r.n(a),n=r(2115),o=r(3239),l=r(1594),d=r(8617),c=r(767);let m=(0,n.createContext)(void 0);function f(e){let{children:t}=e,[r,a]=(0,n.useState)([]),s=(0,n.useCallback)(e=>{a(t=>t.filter(t=>t.id!==e))},[]),o=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=Date.now();a(i=>[...i,{id:r,message:e,type:t}]),setTimeout(()=>s(r),5e3)},[s]);return(0,i.jsxs)(m.Provider,{value:{showToast:o},children:[t,(0,i.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,display:"flex",flexDirection:"column",gap:"10px",pointerEvents:"none"},children:r.map(e=>(0,i.jsx)(p,{toast:e,onClose:()=>s(e.id)},e.id))})]})}function p(e){let{toast:t,onClose:r}=e,a=(()=>{switch(t.type){case"success":return{bg:"#f0fdf4",border:"#bbf7d0",color:"#15803d",icon:(0,i.jsx)(o.A,{size:20})};case"error":return{bg:"#fef2f2",border:"#fecaca",color:"#b91c1c",icon:(0,i.jsx)(l.A,{size:20})};case"warning":return{bg:"#fffbeb",border:"#fef3c7",color:"#b45309",icon:(0,i.jsx)(l.A,{size:20})};default:return{bg:"#eff6ff",border:"#dbeafe",color:"#1d4ed8",icon:(0,i.jsx)(d.A,{size:20})}}})();return(0,i.jsxs)("div",{style:{background:a.bg,border:"1px solid ".concat(a.border),color:a.color,padding:"12px 20px",borderRadius:"16px",boxShadow:"0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05)",display:"flex",alignItems:"center",gap:"12px",minWidth:"300px",maxWidth:"450px",pointerEvents:"auto",animation:"slideIn 0.3s ease-out forwards",position:"relative",overflow:"hidden"},className:"jsx-e320f81d480ff09a",children:[(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-e320f81d480ff09a",children:a.icon}),(0,i.jsx)("div",{style:{fontSize:"0.95rem",fontWeight:"600",flex:1},className:"jsx-e320f81d480ff09a",children:t.message}),(0,i.jsx)("button",{onClick:r,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",opacity:.6,padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},className:"jsx-e320f81d480ff09a",children:(0,i.jsx)(c.A,{size:16})}),(0,i.jsx)("div",{style:{position:"absolute",bottom:0,left:0,height:"3px",background:a.color,opacity:.2,animation:"progress 5s linear forwards"},className:"jsx-e320f81d480ff09a"}),(0,i.jsx)(s(),{id:"e320f81d480ff09a",children:"@-webkit-keyframes slideIn{from{-webkit-transform:translatex(100%);transform:translatex(100%);opacity:0}to{-webkit-transform:translatex(0);transform:translatex(0);opacity:1}}@-moz-keyframes slideIn{from{-moz-transform:translatex(100%);transform:translatex(100%);opacity:0}to{-moz-transform:translatex(0);transform:translatex(0);opacity:1}}@-o-keyframes slideIn{from{-o-transform:translatex(100%);transform:translatex(100%);opacity:0}to{-o-transform:translatex(0);transform:translatex(0);opacity:1}}@keyframes slideIn{from{-webkit-transform:translatex(100%);-moz-transform:translatex(100%);-o-transform:translatex(100%);transform:translatex(100%);opacity:0}to{-webkit-transform:translatex(0);-moz-transform:translatex(0);-o-transform:translatex(0);transform:translatex(0);opacity:1}}@-webkit-keyframes progress{from{width:100%}to{width:0%}}@-moz-keyframes progress{from{width:100%}to{width:0%}}@-o-keyframes progress{from{width:100%}to{width:0%}}@keyframes progress{from{width:100%}to{width:0%}}"})]})}let x=()=>{let e=(0,n.useContext)(m);if(!e)throw Error("useToast must be used within ToastProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[8173,5099,380,8441,1517,7358],()=>t(8557)),_N_E=e.O()}]);