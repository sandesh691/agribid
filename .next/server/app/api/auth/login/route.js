(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{"use strict";e.exports=require("node:crypto")},44513:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>J,routeModule:()=>E,serverHooks:()=>R,workAsyncStorage:()=>k,workUnitAsyncStorage:()=>q});var s={};r.r(s),r.d(s,{POST:()=>U});var a=r(42706),i=r(28203),n=r(45994),o=r(39187),d=r(84272),c=r(77598),u=r(28981),p=r(8848),l=r(73127),h=r(87427);async function w(e,t,r){let s=await (0,h.j)(e,t,"sign");return(0,l.O)(e,s),new Uint8Array(await crypto.subtle.sign((0,p.B)(e,s.algorithm),s,r))}var f=r(5097),g=r(3014),y=r(68510),H=r(46667),m=r(51571),x=r(22421);class b{#e;#t;#r;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#e=e}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setUnprotectedHeader(e){if(this.#r)throw TypeError("setUnprotectedHeader can only be called once");return this.#r=e,this}async sign(e,t){let r,s,a,i;if(!this.#t&&!this.#r)throw new g.Ye("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,f.f)(this.#t,this.#r))throw new g.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this.#t,...this.#r},o=(0,m.n)(g.Ye,new Map([["b64",!0]]),t?.crit,this.#t,n),d=!0;if(o.has("b64")&&"boolean"!=typeof(d=this.#t.b64))throw new g.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:c}=n;if("string"!=typeof c||!c)throw new g.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,H.y)(c,e,"sign"),d?(r=(0,u.l)(this.#e),s=(0,y.lF)(r)):(s=this.#e,r=""),this.#t?(a=(0,u.l)(JSON.stringify(this.#t)),i=(0,y.lF)(a)):(a="",i=new Uint8Array);let p=(0,y.xW)(i,(0,y.lF)("."),s),l=await (0,x.l)(e,c),h=await w(c,l,p),b={signature:(0,u.l)(h),payload:r};return this.#r&&(b.header=this.#r),this.#t&&(b.protected=a),b}}class j{#s;constructor(e){this.#s=new b(e)}setProtectedHeader(e){return this.#s.setProtectedHeader(e),this}async sign(e,t){let r=await this.#s.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}var v=r(42330);class P{#t;#a;constructor(e={}){this.#a=new v.cE(e)}setIssuer(e){return this.#a.iss=e,this}setSubject(e){return this.#a.sub=e,this}setAudience(e){return this.#a.aud=e,this}setJti(e){return this.#a.jti=e,this}setNotBefore(e){return this.#a.nbf=e,this}setExpirationTime(e){return this.#a.exp=e,this}setIssuedAt(e){return this.#a.iat=e,this}setProtectedHeader(e){return this.#t=e,this}async sign(e,t){let r=new j(this.#a.data());if(r.setProtectedHeader(this.#t),Array.isArray(this.#t?.crit)&&this.#t.crit.includes("b64")&&!1===this.#t.b64)throw new g.Dp("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}var S=r(44512);let T=(e,t)=>{if(!t||!t.includes(":"))return console.warn("[AgriBid] Legacy or invalid password hash detected. Verification failed."),!1;let[r,s]=t.split(":"),a=(0,c.scryptSync)(e,r,64).toString("hex");return(0,c.timingSafeEqual)(Buffer.from(s,"hex"),Buffer.from(a,"hex"))},A=new TextEncoder().encode(process.env.JWT_SECRET||"agribid-secret-key-123456789");async function U(e){try{let{email:t,password:r}=await e.json(),s=await d.z.user.findUnique({where:{email:t},include:{farmerProfile:!0,retailerProfile:!0}});if(!s||!T(r,s.passwordHash))return o.NextResponse.json({error:"Invalid credentials"},{status:401});if("SUSPENDED"===s.accountStatus)return o.NextResponse.json({error:"Your account has been suspended. Please contact admin."},{status:403});let a=await new P({userId:s.id,role:s.role,email:s.email}).setProtectedHeader({alg:"HS256"}).setExpirationTime("24h").sign(A);return(await (0,S.UL)()).set("agribid-session",a,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:86400}),o.NextResponse.json({user:{id:s.id,email:s.email,role:s.role,verified:s.verified,trustScore:s.trustScore,language:s.language}})}catch(e){return console.error("Login error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let E=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\pprit\\OneDrive\\Desktop\\hgmodel\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:k,workUnitAsyncStorage:q,serverHooks:R}=E;function J(){return(0,n.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:q})}},96487:()=>{},78335:()=>{},84272:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});let s=require("@prisma/client"),a=globalThis.prisma??new s.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,4512,5452,2847],()=>r(44513));module.exports=s})();